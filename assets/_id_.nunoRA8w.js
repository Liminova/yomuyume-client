import{_ as R}from"./Snackbar.6kPXEGFe.js";import{f as U,_ as P}from"./ImagePoly.vue.ISAFMTdm.js";import{q as $,s as p,x as j,C as z,r as l,n as V,f as D,o as b,c as h,b as w,u as o,w as O,a as u,t as x,K as S,I as B,d as E,F as q,E as M}from"./entry.DjtswmJf.js";import"./text-button.7UNOjzLC.js";import{d as K}from"./Toggle.W4OZ0JVF.js";import{i as Q}from"./index.LtI9aITs.js";import{_ as G}from"./NavDrawerWrapper.vue.F6N0lJJv.js";import"./ripple.uo11bOlx.js";import"./md-focus-ring.EDTuL-Ow.js";import"./form-label-activation.WOp997Gu.js";import"./NavDrawer.vue.24GOB-vt.js";import"./NavEntry.vue.TJnkqCfA.js";import"./nuxt-link.WvWVQSa8.js";import"./ThemeToggle.ggFxuZMW.js";import"./changeTheme.l_0xQP93.js";import"./TopBar.vue.OxoDJeE5.js";import"./FilterBar.vue.R2vvxxwL.js";import"./LogoAndTitle.ak1Cv3c_.js";import"./NavToggleIcon.kUTHk7CN.js";import"./UserAvatar.vue.pe-xSWwJ.js";async function H(d,c){var t;const{status:s,error:r}=await $(`/api/user/favorite/${d}`,{baseURL:p.instanceAddr,method:c,headers:{Authorization:`Bearer ${p.token}`}},"$onAuu65brF");if(s.value==="error"){const m=(t=r.value)==null?void 0:t.data;return{status:s.value,message:m.message??"Failed to favorite, server doesn't give any reason."}}return{status:s.value,message:"Added to favorite."}}async function J(d,c){var t;const{status:s,error:r}=await $(`/api/user/bookmark/${d}`,{baseURL:p.instanceAddr,method:c,headers:{Authorization:`Bearer ${p.token}`}},"$O7jofw9NjL");if(s.value==="error"){const m=(t=r.value)==null?void 0:t.data;return{status:s.value,message:m.message??"Failed to bookmark, server doesn't give any reason."}}return{status:s.value,message:"Added to bookmark."}}async function W(d,c){var t;const{status:s,error:r}=await $(`/api/user/progress/${d}/${c}`,{baseURL:p.instanceAddr,method:"PUT",headers:{Authorization:`Bearer ${p.token}`}},"$vNQBNqLjht");if(s.value==="error"){const m=(t=r.value)==null?void 0:t.data;return{status:s.value,message:m.message??"Failed to progress, server doesn't give any reason."}}return{status:s.value,message:""}}const A={favorite:H,bookmark:J,progress:W},X={class:"mt-3 px-0 lg:mt-0 lg:pl-0 lg:pr-3"},Y={class:"mb-7 px-7 lg:px-0"},Z={class:"text-6xl font-semibold"},ee={key:0,class:"mt-7 text-justify"},te={class:"my-7 flex w-full grow-[100] flex-row items-center justify-center gap-7"},ae=["id"],Ae=j({__name:"[id]",setup(d){const s=z().params.id,r=Array.isArray(s)?s[0]:s,t=l(""),m=l(5e3),v=l({}),n=l(!1),i=l(!1),g=l(0),_=l(0);(async()=>{const{data:e,status:a}=await Q.title(r);if(a==="error"||!e){await V("/404");return}v.value=e,document.title=e.title,n.value=e.is_favorite??!1,i.value=e.is_bookmark??!1,g.value=e.favorites??0,_.value=e.bookmarks??0})();async function F(){const{message:e,status:a}=await A.favorite(r,n.value?"DELETE":"PUT");if(a==="error"){t.value=e;return}g.value=g.value+(n.value?-1:1),n.value=!n.value,t.value=n.value?"Added to favorites":"Removed from favorites"}async function C(){const{message:e,status:a}=await A.bookmark(r,i.value?"DELETE":"PUT");if(a==="error"){t.value=e;return}_.value=_.value+(i.value?-1:1),i.value=!i.value,t.value=i.value?"Added to bookmarks":"Removed from bookmarks"}const L=l(0),I=new IntersectionObserver(e=>{for(const a of e){if(!a.isIntersecting)continue;const k=a.target;L.value=v.value.pages.findIndex(y=>y.id===k.id)}},{root:null,rootMargin:"0px",threshold:.5});async function T(e){const{status:a,message:k}=await A.progress(r,e);a==="error"&&(t.value=k)}D(()=>{K(T,3e4)(L.value)});function N(e){const a=document.getElementById(e);a!==null&&I.observe(a)}return(e,a)=>{const k=R,y=P;return b(),h("div",null,[w(k,{message:o(t),timeout:o(m),onClose:a[0]||(a[0]=f=>t.value="")},null,8,["message","timeout"]),w(G,null,{default:O(()=>[u("div",X,[u("div",Y,[u("div",Z,x(o(v).title),1),o(v).desc?(b(),h("div",ee,x(o(v).desc),1)):S("",!0)]),u("div",te,[u("md-text-button",{class:"scale-125",onClick:C},[u("i",{class:B(["fa-bookmark",{"fa-solid":o(i),"fa-light":!o(i)}])},null,2),E(" "+x(o(_)>0?o(_):""),1)]),u("md-text-button",{class:"scale-125",onClick:F},[u("i",{class:B(["fa-heart",{"fa-solid":o(n),"fa-light":!o(n)}])},null,2),E(" "+x(o(g)>0?o(g):""),1)])]),(b(!0),h(q,null,M(o(v).pages,f=>(b(),h("div",{key:f.id,id:f.id,class:"mx-auto max-w-[700px]"},[w(y,{onLoaded:se=>N(f.id),image:{src:o(U).page(f.id),format:f.format}},null,8,["onLoaded","image"])],8,ae))),128))])]),_:1})])}}});export{Ae as default};
