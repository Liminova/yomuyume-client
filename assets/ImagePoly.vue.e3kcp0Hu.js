var W=Object.defineProperty;var k=(a,e,r)=>e in a?W(a,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[e]=r;var n=(a,e,r)=>(k(a,typeof e!="symbol"?e+"":e,r),r);import{s as l,x as B,r as u,o as d,c as h,u as o,I as c,G as p,K as m}from"./entry.Iu585iSW.js";function R(a){return new URL(`/api/file/thumbnail/${a}`,l.instanceAddr).toString()}function U(a){return new URL(`/api/file/page/${a}`,l.instanceAddr).toString()}const D={thumbnail:R,page:U};async function f(a,e){const r=new Image;return r.src=`data:image/${a};base64,${e}`,new Promise((A,s)=>{r.onload=()=>{A(!0)},r.onerror=()=>{A(!1)}})}let g=!1,b=!1;Promise.all([f("avif","AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),f("jxl","/woIAAAMABKIAgC4AF3lEgAAFSqjjBu8nOv58kOHxbSN6wxttW1hSaLIODZJJ3BIEkkaoCUzGM6qJAE=")]).then(a=>{g=a[0],b=a[1]});const v=4,S=8;async function y(a){switch(a){case"jxl":return Promise.resolve(b);case"avif":return Promise.resolve(g);default:return Promise.resolve(!0)}}class _{constructor(){n(this,"blurhashQueue",[]);n(this,"imageQueue",[]);n(this,"blurhashWorkers",[]);n(this,"imageWorkers",[]);n(this,"polyfillWorkersSpunUp",!1);this.blurhashWorkers=Array.from({length:S},()=>({instance:new Worker(new URL(""+new URL("blurhash.web-4i6DAMGF.js",import.meta.url).href,import.meta.url),{type:"module",name:"blurhashRenderer"}),isReady:!0}))}spinUpPolyfillWorkers(){this.polyfillWorkersSpunUp=!0,this.imageWorkers=Array.from({length:v},()=>({instance:new Worker(new URL(""+new URL("image.web-O_LFXT90.js",import.meta.url).href,import.meta.url),{type:"module",name:"imageRenderer"}),isReady:!0}))}processQueue(e,r){const A=r.find(s=>s.isReady);if(A&&e.length>0){const s=e.shift();if(!s)return;A.isReady=!1,A.instance.onmessage=t=>{s.renderedDataRef.value=t.data,A.isReady=!0,this.processQueue(e,r)},A.instance.postMessage(s.data)}}async new(e,r,A){if(e.width!==void 0&&e.height!==void 0&&e.blurhash&&(this.blurhashQueue.push({data:[e.blurhash,e.width,e.height],renderedDataRef:r}),this.processQueue(this.blurhashQueue,this.blurhashWorkers)),await y(e.format)){A.value=e.src;return}this.polyfillWorkersSpunUp||this.spinUpPolyfillWorkers(),this.imageQueue.push({data:[e.src,e.format,l.token],renderedDataRef:A}),this.processQueue(this.imageQueue,this.imageWorkers)}}class L{async new(e,r,A){if(e.width!==void 0&&e.height!==void 0&&e.blurhash){const t=new SharedWorker(new URL(""+new URL("blurhash.shared-XsheFu_a.js",import.meta.url).href,import.meta.url),{type:"module",name:"blurhashRenderer"});t.port.onmessage=i=>r.value=i.data,t.port.postMessage([e.blurhash,e.width,e.height])}if(await y(e.format)){A.value=e.src;return}const s=new SharedWorker(new URL(""+new URL("image.shared-bOVh67Ur.js",import.meta.url).href,import.meta.url),{type:"module",name:"imageRenderer"});s.port.onmessage=t=>{A.value=t.data},s.port.postMessage([e.src,e.format,l.token])}}const Q="SharedWorker"in window?new L:new _;function E(a,e,r){Q.new(a,e,r)}const I=["loading","src","draggable"],j=["loading","src","draggable"],M=B({__name:"ImagePoly",props:{class:{type:String,default:""},draggable:{type:Boolean,default:!1},image:{type:Object,required:!0},imageClass:{type:String,default:""},lazy:{type:Boolean,default:!0}},emits:["loaded"],setup(a,{emit:e}){const r=a,A=u(""),s=u(""),t=u(!1),i=e;function w(){t.value=!0,i("loaded")}return E(r.image,A,s),(C,x)=>(d(),h("div",{class:c(["relative",r.class])},[r.image.blurhash&&o(A)&&!o(t)?(d(),h("img",{key:0,loading:r.lazy?"lazy":"eager",class:c(["left-0 top-0 -z-10",r.imageClass]),style:p({position:o(t)?"absolute":"static"}),src:o(A),draggable:r.draggable},null,14,I)):m("",!0),o(s)?(d(),h("img",{key:1,loading:r.lazy?"lazy":"eager",class:c(["left-0 top-0",r.imageClass]),style:p({transition:"opacity 0.5s ease",position:o(t)?"static":"absolute"}),src:o(s),draggable:r.draggable,onLoad:w},null,46,j)):m("",!0)],2))}});export{M as _,D as f};
